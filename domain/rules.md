# Project Rules

Project-specific coding rules. Extends `~/.claude/rules/`. Auto-generated by `/dm-init` or filled manually.

## Code Style

### Naming
```
Components:    PascalCase      (UserCard, LoginForm)
Functions:     camelCase       (fetchUser, validateEmail)
Constants:     SCREAMING_CASE  (MAX_RETRIES, API_BASE_URL)
Types:         PascalCase      (User, ApiResponse)
Files:         kebab-case      (user-card.tsx) or PascalCase (UserCard.tsx)
```

### Patterns
```
// Prefer early returns
function process(data) {
  if (!data) return null
  if (!data.valid) return { error: 'Invalid' }
  return transform(data)
}

// Prefer const over let
const user = getUser()

// Prefer destructuring
const { name, email } = user
```

## File Rules

### Max Lines
- Components: 200
- Utilities: 100
- Tests: 300
- API Routes: 150

### Forbidden
- `any` type without explicit comment justification
- `@ts-ignore` / `@ts-expect-error`
- `console.log` in committed code
- Hardcoded secrets or credentials
- Direct DOM manipulation in React/Vue/Svelte

## Git Rules

### Branch Naming
```
feature/[ticket-id]-[description]    # feature/PROJ-123-add-auth
fix/[ticket-id]-[description]        # fix/PROJ-456-login-error
hotfix/[description]                 # hotfix/critical-security-patch
chore/[description]                  # chore/update-dependencies
```

### Commit Format
```
[type]([scope]): [description]

Types: feat, fix, refactor, docs, test, chore, perf
Scope: component name, module, or area

Examples:
feat(auth): add Google OAuth login
fix(api): handle null response in user endpoint
refactor(dashboard): extract chart components
```

### PR Rules
- Descriptive title matching commit format
- Link to related issue/ticket
- Include summary of changes
- Request review from code owner
- All CI checks must pass

## Testing Rules

### Coverage Requirements
- Overall: 80% minimum
- Critical paths: 100% (auth, payments)
- New features: must include tests

### Test Naming
```typescript
describe('ComponentName', () => {
  it('should [expected behavior] when [condition]', () => {
    // test
  })
})

// Examples:
it('should display error message when form is invalid')
it('should redirect to dashboard when login succeeds')
```

## API Rules

### Response Format
```json
{
  "success": true,
  "data": {},
  "error": null,
  "meta": { "total": 100, "page": 1, "limit": 10 }
}
```

### Error Codes
| Code | Meaning |
|------|---------|
| 400 | Bad Request - Invalid input |
| 401 | Unauthorized - Auth required |
| 403 | Forbidden - Insufficient permissions |
| 404 | Not Found - Resource doesn't exist |
| 409 | Conflict - Resource already exists |
| 422 | Unprocessable - Validation failed |
| 429 | Too Many Requests - Rate limited |
| 500 | Internal Error - Server failure |

## Security Rules

- All inputs must be validated with schemas
- Use parameterized queries only (no string concatenation)
- Store secrets in environment variables
- Enable Row Level Security on all tables
- Rate limit all public endpoints

## Performance Rules

- Lazy load components not visible on initial render
- Optimize images (WebP, proper sizing)
- Use server components for data fetching
- Cache expensive computations
- Avoid N+1 queries

## Exceptions

Global rules that have exceptions in this project:

| Rule | Exception | Reason |
|------|-----------|--------|
| No console.log | Allowed in development utils | Debug tooling |
